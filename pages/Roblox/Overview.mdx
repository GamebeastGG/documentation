import ReturnType from '/components/ReturnType.tsx';
import {ParameterList, Parameter} from '/components/Parameter.tsx';

# Roblox SDK

Use this section to review required setup functions and examples for the Roblox SDK.

Refer to the [Intallation](/Roblox/Installation) section for installation information.


## Calling into Gamebeast from Roblox

```lua filename="server.lua" copy numbered
-- Server Script
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Gamebeast = require(ReplicatedStorage:WaitForChild("Gamebeast"))
 
Gamebeast:Setup({
    key = "abcd-efgh-1234-5678",
})
```

```lua filename="client.lua" copy numbered
-- Client Script
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Gamebeast = require(ReplicatedStorage:WaitForChild("Gamebeast"))
 
Gamebeast:Setup()
```

### IMPORTANT: Tracking Dev Product purchases

If you are using Dev Products in your game, it is highly recommeded to implement the [:SendNewPurchaseGrantedMarker](/Roblox/API/Markers#sendnewpurchasegrantedmarkerreceiptinfo-position) method to track purchases accurately.


## SDK Usage Considerations

#### Do not clear the `shared` global table.

Gamebeast's Roblox SDK uses `shared.GBMod` to fetch modules within its internal framework. Clearing this table will result in the SDK erroring during startup.
It's okay to add additional entries to `shared` as long as GBMod is not overwritten.

#### It is unsafe to change the SDK's source.

The SDK is designed to be a black box, modifying its source code can lead to unexpected behavior. 
Changes will not be preserved when the plugin updates the SDK. 
If you're interested in additional functionality, please reach out.

## Default Behaviors

### Default Markers

The SDK will automatically send certain default markers to help track player activity in your experience. These include things like player joins, leaves, and place teleports. 

For a full list of default markers sent by the Gamebeast Roblox SDK, view the dropdown below:

<details>
<summary>View Default Markers</summary>
**Login**

Triggered when a player logs in to your experience. 

This does not include when joining from a teleport within the same experience, such as teleporting to the main place from the lobby place.

Arguments:
<ParameterList>
    <Parameter name="policyInfo" type="{[string] : any}">
        the policy information of the player retrieved from `PolicyService:GetPolicyInfoForPlayerAsync()`
    </Parameter>
</ParameterList>

<hr/>

**Logout**

Triggered when a player leaves your experience. This does not include leaving by teleports to places within the same experience.

Arguments:
<ParameterList>
    <Parameter name="sessionLength" type="number">
        The length of the player's session in seconds across all places in the experience.
    </Parameter>
    <Parameter name="sessionLengthPercentageWithFriends" type="number">
        A 0-1 representation of the percentage of the player's session spent with friends.
    </Parameter>
</ParameterList>

<hr/>

**JoinedUser**

Triggered when a player joins another player in your experience.

Arguments:
<ParameterList>
    <Parameter name="userId" type="number">
        The ID of the user that the player joined.
    </Parameter>
    <Parameter name="isFriend" type="boolean">
        Whether the user that the player joined is a friend.
    </Parameter>
</ParameterList>

**PlaceTeleport**

Triggered when a player teleports to a different place within your experience.

Arguments:
<ParameterList>
    <Parameter name="sourcePlaceId" type="number">
        The ID of the place the player is teleporting from.
    </Parameter>
    <Parameter name="destinationPlaceId" type="number">
        The ID of the place the player is teleporting to.
    </Parameter>
    <Parameter name="sessionLength" type="number">
        The length of the player's session in seconds within that place.
    </Parameter>
</ParameterList>

**Purchase**

Triggered when a player makes a purchase in your experience, such as buying a developer product, game pass, asset, or subscription.

Arguments:
<ParameterList>
    <Parameter name="type" type="string">
        The type of purchase made by the player. This can be set to `gamepass`, `asset`, `devproduct` or `subscription`.
    </Parameter>
    <Parameter name="fromReceipt" type="boolean">
        Whether or not this purchase marker was made from the receipt of a purchase via `MarkersService:SendNewPurchaseGrantedMarker()`
    </Parameter>
    <Parameter name="id" type="number">
        The Roblox provided identifier for the purchased item.
    </Parameter>
    <Parameter name="price" type="number">
        The price of the purchased item. This is the price the player paid, which may differ from the base price if discounts are applied from Roblox's geographic pricing.
    </Parameter>
    <Parameter name="basePrice" type="number">
        The default price of the purchased item.
    </Parameter>
    <Parameter name="name" type="string">
        The name of the purchased item.
    </Parameter>
    <Parameter name="description" type="string">
        The description of the purchased item.
    </Parameter>
    <Parameter name="imageId" type="string">
        The image URL of the purchased item.
    </Parameter>
</ParameterList>

**Chat**

Triggered when a player sends a chat message in your experience.

Arguments:
<ParameterList>
    <Parameter name="message" type="string">
        The chat message sent by the player.
    </Parameter>
</ParameterList>
</details>

## SDK Methods

```lua
local Gamebeast = require(game:GetService("ReplicatedStorage"):WaitForChild("Gamebeast"))
```

## :Setup(setupConfig)
<ReturnType/>

This function must be called once on the server and client to initialize the Gamebeast SDK.
Attempting to call any other SDK method before calling `:Setup` will result in an error.

<ParameterList name="Parameters">
    <Parameter name="setupConfig" type="ServerSetupConfig?">
        The required config table for the SDK.
    </Parameter>
</ParameterList>

### Types

```luau
type SDKSettings = {
	-- Enables SDK warnings for API misuse, internal errors, etc.
	sdkWarningsEnabled : boolean,
	-- Enables stack trace inclusion with warning messages.
	includeWarningStackTrace : boolean,
}
type ServerSetupConfig = {
	key : string | Secret,
	sdkSettings : SDKSettings?
}
```

### Usage
```lua
-- Server
Gamebeast:Setup({
    key = "abcd-efgh-1234-5678",
    sdkSettings = {
        sdkWarningsEnabled = true,
        includeWarningStackTrace = false,
    }
})

-- Client
Gamebeast:Setup()
```

if `sdkSettings` is not provided, the following are the defaults that will be used.

```lua
{
    sdkWarningsEnabled = true,
    includeWarningStackTrace = false,
}
```

## :GetService(serviceName)
<ReturnType type="GamebeastService"/>
This method will attempt to fetch a service module from the Gamebeast SDK.
All available services can be found documented [here.](/Roblox/API)

<ParameterList name="Parameters">
    <Parameter name="serviceName" type="string">
        The name of the SDK service.
    </Parameter>
</ParameterList>

### Usage
```lua
GamebeastMarkers = Gamebeast:GetService("Markers") :: Gamebeast.MarkersService
```